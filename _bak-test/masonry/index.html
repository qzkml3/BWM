<script src="/-bwm/js/jquery/jquery-1.8.3.min.js"></script>
<script src="masonry.pkgd.min.js"></script>

<style>
	.grid {display: flex; flex-wrap: wrap;}
	.grid-item {border: solid 3px gray; box-sizing: border-box; word-break: break-all; margin-bottom: 2%;
		width: 24%;
	}
	.gutter-sizer {width: 1.1%;}
</style>

<script>
	$(document).ready(function () {
		$('.grid').masonry({
			gutter: '.gutter-sizer',
			itemSelector: '.grid-item',
			columnWidth: '.grid-sizer',
			percentPosition: true 
		});
	});
	
	$(document).on('click', function () {
		var v = $('.grid').html();
		$v = $(v);

		//$('.grid').append($v).masonry( 'appended', $v );
		
		
		$('.grid').append($v).masonry( 'appended', $v , true);
		$('.grid').masonry( 'reloadItems' );

	
	
	
	});


</script>

<button type="button">Document click append</button>

<div class="grid">
	<div class="grid-sizer"></div>
	<div class="gutter-sizer"></div>
	<?php
	for ($i = 0; $i < 10; $i++) {
		$h = rand(20, 50);
		?>
		<div class="grid-item">
			<div><?=$i+1?></div>

			<?for ($i2 = 0; $i2 < $h; $i2++) {
			echo 'x';
			}?>
		
		</div>
	<?php } ?>
</div>

<!--<div class="grid">
	<?php
/*	for ($i = 0; $i < 10; $i++) {
		$h = rand(50, 300);
		*/?>
		<div class="grid-item" style="height: <?/*=$h*/?>px;"><?/*=$i+1*/?></div>
	<?php /*} */?>
</div>-->